text = """
.#....#.###.........#..##.###.#.....##...
...........##.......#.#...#...#..#....#..
...#....##..##.......#..........###..#...
....#....####......#..#.#........#.......
...............##..#....#...##..#...#..#.
..#....#....#..#.....#.#......#..#...#...
.....#.#....#.#...##.........#...#.......
#...##.#.#...#.......#....#........#.....
....##........#....#..........#.......#..
..##..........##.....#....#.........#....
...#..##......#..#.#.#...#...............
..#.##.........#...#.#.....#........#....
#.#.#.#......#.#...##...#.........##....#
.#....#..#.....#.#......##.##...#.......#
..#..##.....#..#.........#...##.....#..#.
##.#...#.#.#.#.#.#.........#..#...#.##...
.#.....#......##..#.#..#....#....#####...
........#...##...#.....#.......#....#.#.#
#......#..#..#.#.#....##..#......###.....
............#..#.#.#....#.....##..#......
...#.#.....#..#.......#..#.#............#
.#.#.....#..##.....#..#..............#...
.#.#....##.....#......##..#...#......#...
.......#..........#.###....#.#...##.#....
.....##.#..#.....#.#.#......#...##..#.#..
.#....#...#.#.#.......##.#.........#.#...
##.........#............#.#......#....#..
.#......#.............#.#......#.........
.......#...##........#...##......#....#..
#..#.....#.#...##.#.#......##...#.#..#...
#....##...#.#........#..........##.......
..#.#.....#.....###.#..#.........#......#
......##.#...#.#..#..#.##..............#.
.......##.#..#.#.............#..#.#......
...#....##.##..#..#..#.....#...##.#......
#....#..#.#....#...###...#.#.......#.....
.#..#...#......##.#..#..#........#....#..
..#.##.#...#......###.....#.#........##..
#.##.###.........#...##.....#..#....#.#..
..........#...#..##..#..##....#.........#
..#..#....###..........##..#...#...#..#..
""".strip()


import math
import numpy as np
import pandas as pd
from collections import Counter, deque


def get_angle(i1, j1, i2, j2):
    angle_radians = math.atan2(j2-j1, i1-i2)
    if angle_radians < 0.0:
        angle_radians += 2*math.pi;
    return round(math.degrees(angle_radians), 9)


array = np.array([list(x) for x in text.splitlines()])
asteroid_positions = list(zip(*np.where(array == '#')))


# 1
scores = dict()
for i, j in asteroid_positions:
    angles = [get_angle(i, j, i1, j1) for i1, j1 in asteroid_positions if (i1, j1) != (i, j)]
    scores[(i, j)] = len(Counter(angles))
i0, j0 = max(scores, key=lambda k: scores[k])
print(scores[i0, j0])


# 2
angles = {(i, j): get_angle(i0, j0, i, j) for i, j in asteroid_positions if (i, j) != (i0, j0)}
i_distances = {(i, j): abs(i-i0) for i, j in asteroid_positions if (i, j) != (i0, j0)}
queue = deque(pd.DataFrame([angles, i_distances]).T.sort_values([0, 1]).reset_index().values)

def num_distinct_angles(queue):
    return len(Counter(np.array(list(queue))[:, 1]))

results = []
previous_angle = -1
while queue:
    x = queue.popleft()
    (i, j), angle, distance = x
    if angle == previous_angle and queue and num_distinct_angles(queue) > 1:
        queue.append(x)
        continue
    results.append((i, j))
    previous_angle = angle
print(results[199][1] * 100 + results[199][0])
